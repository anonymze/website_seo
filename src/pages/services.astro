---
import Layout from "@/layouts/layout.astro";
import { CalculatorIcon } from "lucide-react";

// Page SEO data
const pageData = {
    title: "Services - Yann Metier Création de Sites Web",
    description:
        "Découvrez mes services de création de sites web : sites vitrines, e-commerce, applications mobiles. Devis personnalisés et solutions sur-mesure.",
    keywords:
        "services web, création site vitrine, e-commerce, développement web, devis site internet, développeur freelance France",
};

// Features data
const features = [
    {
        id: "responsive",
        label: "Site adapté mobile et tablette",
        price: 0,
        included: true,
    },
    {
        id: "seo",
        label: "Référencement Google de base",
        price: 0,
        included: true,
    },
    {
        id: "ai-design",
        label: "2 propositions de design du site générées par IA selon vos préférences",
        price: 0,
        included: true,
    },
    {
        id: "hosting",
        label: "Hébergement en ligne sous un nom de domaine personnalisé (ex: mon-site-important.fr)",
        subscription: "60€ / an",
        included: true,
    },
    {
        id: "maintenance",
        label: "Maintenance et mises à jour",
        price: 0,
        special: "1ère année offerte",
        subscription: "300€ / an",
    },
    {
        id: "analytics",
        label: "Statistiques de visite détaillées",
        price: 50,
        included: false,
    },
    {
        id: "newsletter",
        label: "Envoi d'emails automatique (newsletter)",
        price: 100,
        subscription: "8€ / mois",
    },
    {
        id: "booking",
        label: "Prise de rendez-vous en ligne",
        price: 100,
        subscription: "10€ / mois",
    },
    { id: "multilang", label: "Site en plusieurs langues", price: 200 },
    { id: "payment", label: "Paiement en ligne sécurisé", price: 600 },
    {
        id: "dashboard",
        label: "Panneau d'administration avec espace client et / ou gestion de contenu",
        price: 600,
    },
    {
        id: "pro-design",
        label: "Design du site sur mesure réalisé par un professionnel",
        price: 0,
        special: "Entre 1000€ et 5000€ selon complexité projet",
    },
];
---

<Layout
    title={pageData.title}
    description={pageData.description}
    keywords={pageData.keywords}
    type="website"
>
    <!-- Hero Section -->
    <section
        class="pt-20 bg-gradient-to-b from-card/60 to-background/30"
        aria-labelledby="hero-heading"
        role="banner"
    >
        <header class="text-center mb-12">
            <div
                class="h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center mx-auto mb-6"
            >
                <CalculatorIcon className="w-6 h-6 text-primary" />
            </div>
            <h1
                id="hero-heading"
                class="font-bold text-4xl md:text-5xl text-foreground mb-6 leading-tight"
            >
                Estimez le prix de votre site internet
            </h1>
            <p
                class="text-muted-foreground text-xl max-w-2xl mx-auto leading-relaxed"
            >
                Obtenez une estimation rapide en quelques clics. Demandez un
                devis gratuit, personnalisé et détaillé à la suite d'une prise
                de contact.
            </p>
        </header>
    </section>

    <!-- Quote Form Section -->
    <section class="pb-20" aria-labelledby="quote-heading">
        <article
            class="border border-border/20 rounded-3xl bg-card/60 backdrop-blur-lg overflow-hidden"
        >
            <header class="p-8 pb-6 border-b border-border/20">
                <h2 class="text-2xl font-bold text-foreground mb-2">
                    Configurateur de devis
                </h2>
                <p class="text-muted-foreground">
                    Sélectionnez vos options pour obtenir une estimation
                    approximative
                </p>
            </header>

            <div class="p-8 space-y-6">
                <!-- Features -->
                <div class="space-y-4">
                    <label
                        class="text-sm font-medium text-foreground inline-block"
                        >Fonctionnalités souhaitées</label
                    >
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        {
                            features.map((feature) => (
                                <label class="flex items-center space-x-2 p-3 border border-border/20 rounded-xl hover:bg-muted/50 transition-colors cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="features"
                                        value={feature.id}
                                        data-price={feature.price}
                                        checked={feature.included}
                                        disabled={feature.included}
                                        class="w-4 h-4 text-primary border-border focus:ring-primary focus:ring-2 disabled:opacity-50"
                                    />
                                    <div class="text-sm flex-1">
                                        <span class="text-foreground">
                                            {feature.label}
                                        </span>
                                        <div class="ml-1">
                                            <div>
                                                {feature.included ? (
                                                    <span class="text-primary">
                                                        (inclus)
                                                    </span>
                                                ) : feature.special ? (
                                                    <span class="text-muted-foreground">
                                                        ({feature.special})
                                                    </span>
                                                ) : (
                                                    <span class="text-muted-foreground">
                                                        +{feature.price}€
                                                    </span>
                                                )}
                                            </div>
                                            {feature.subscription && (
                                                <div class="text-xs text-orange-600 mt-1">
                                                    + {feature.subscription}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </label>
                            ))
                        }
                    </div>
                </div>

                <!-- Price Display -->
                <div id="price-display" class="p-4 bg-muted rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-foreground"
                            >Estimation totale :</span
                        >
                        <span
                            class="text-2xl font-bold text-primary"
                            id="total-price">0€</span
                        >
                    </div>
                    <p class="text-sm text-muted-foreground mt-1">
                        Prix indicatif - Devis personnalisé gratuit
                    </p>
                </div>

                <!-- Contact Form -->
                <form class="space-y-4" id="quote-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label
                                for="name"
                                class="text-sm font-medium text-foreground inline-block"
                                >Nom complet *</label
                            >
                            <input
                                type="text"
                                id="name"
                                name="name"
                                required
                                placeholder="Votre nom"
                                class="w-full px-4 py-3 border border-border/20 rounded-xl bg-background/50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            />
                        </div>
                        <div class="space-y-2">
                            <label
                                for="email"
                                class="text-sm font-medium text-foreground inline-block"
                                >Email *</label
                            >
                            <input
                                type="email"
                                id="email"
                                name="email"
                                required
                                placeholder="votre@email.com"
                                class="w-full px-4 py-3 border border-border/20 rounded-xl bg-background/50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                            />
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label
                            for="company"
                            class="text-sm font-medium text-foreground inline-block"
                            >Entreprise (optionnel)</label
                        >
                        <input
                            type="text"
                            id="company"
                            name="company"
                            placeholder="Nom de votre entreprise"
                            class="w-full px-4 py-3 border border-border/20 rounded-xl bg-background/50 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
                        />
                    </div>

                    <button
                        type="submit"
                        id="submit-btn"
                        class="w-full mt-6 inline-flex items-center justify-center px-6 py-4 bg-primary text-primary-foreground rounded-full font-medium text-lg hover:bg-primary/90 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled
                    >
                        Être contacté pour recevoir un devis détaillé
                        <svg
                            class="ml-2 h-4 w-4"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                        >
                            <path d="M5 12h14"></path>
                            <path d="m12 5 7 7-7 7"></path>
                        </svg>
                    </button>

                    <div
                        class="text-xs text-muted-foreground text-center space-y-2"
                    >
                        <p>
                            En soumettant ce formulaire, vous acceptez d'être
                            contacté par email pour recevoir votre devis
                            personnalisé.
                        </p>
                        <p class="text-orange-600 font-medium">
                            Le devis représente une estimation moyenne. Il se
                            peut que certains prix diffèrent selon l'ampleur de
                            votre projet.
                        </p>
                    </div>
                </form>
            </div>
        </article>
    </section>
</Layout>

<script>
    // Form handling and price calculation
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("quote-form");
        const featureInputs = document.querySelectorAll(
            'input[name="features"]',
        );
        const submitBtn = document.getElementById("submit-btn");
        const nameInput = document.getElementById("name");
        const emailInput = document.getElementById("email");
        const priceDisplay = document.getElementById("price-display");
        const totalPriceElement = document.getElementById("total-price");

        // Update price calculation
        function updatePrice() {
            const selectedFeatures = document.querySelectorAll(
                'input[name="features"]:checked:not([disabled])',
            );

            const basePrice = 700;
            let featuresPrice = 0;

            selectedFeatures.forEach((feature) => {
                featuresPrice += parseInt(feature.dataset.price || "0");
            });

            const totalPrice = basePrice + featuresPrice;

            // Always show price display
            totalPriceElement.textContent =
                totalPrice.toLocaleString() + "€";

            updateSubmitButton();
        }

        // Update submit button state
        function updateSubmitButton() {
            const hasName = nameInput.value.trim() !== "";
            const hasEmail = emailInput.value.trim() !== "";

            if (hasName && hasEmail) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        // Add event listeners
        featureInputs.forEach((input) => {
            input.addEventListener("change", updatePrice);
        });

        nameInput.addEventListener("input", updateSubmitButton);
        emailInput.addEventListener("input", updateSubmitButton);

        // Handle form submission
        if (form) {
            form.addEventListener("submit", function (e) {
                e.preventDefault();

                const formData = new FormData(form);
                const selectedFeatures = Array.from(
                    document.querySelectorAll('input[name="features"]:checked'),
                ).map((input) => input.value);

                // Add additional data
                formData.append("features", selectedFeatures.join(","));

                // Here you would normally send the data to your backend
                console.log(
                    "Form data:",
                    Object.fromEntries(formData.entries()),
                );

                // Redirect to contact page with success indicator
                const params = new URLSearchParams({
                    devis: "true",
                    nom: formData.get("name") || "",
                    email: formData.get("email") || "",
                });

                window.location.href = "/contact?" + params.toString();
            });
        }

        // Initialize
        updatePrice();
        updateSubmitButton();
    });
</script>
